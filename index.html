<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>クリコンカスタム用チーム分け </title>
<style>
body { font-family: sans-serif; max-width: 1000px; margin: auto; background: linear-gradient(135deg,#a0e9ff,#f3f0ff,#c0eaff); background-size:400% 400%; animation:crystalGradient 15s ease infinite;}
@keyframes crystalGradient {0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
ul { list-style:none; padding:0; }
li { margin:2px 0; padding:2px 5px; border-radius:4px; color:white; }
table { border-collapse: collapse; margin-bottom:10px; width:100%; }
td,th { border:1px solid #aaa; padding:4px; text-align:center; }
button { margin-top:5px; padding:5px 10px; font-size:14px; cursor:pointer; }
h3.team-title { margin-top:20px; }
input[type="number"] { width:50px; }
</style>
</head>
<body>

<h1>クリコンカスタム用チーム分け </h1>

<section style="margin-bottom:40px;">
<h2>階級・レート参照チーム分け </h2>
<table id="tablePower">
<tr><th>名前</th><th>階級・レート </th></tr>
</table>
<button id="runPower">チーム分け実行</button>
<button id="copyPower">結果をコピー（名前のみ）</button>

<h3 class="team-title">アストラ </h3>
<ul id="teamAPower"></ul>

<h3 class="team-title">アンブラ </h3>
<ul id="teamBPower"></ul>
</section>

<section>
<h2>ロール編成チーム分け（チーム最大5人、フリーは足りないロールを補填）</h2>

<form id="idealForm">
<h3>チームごとのロール人数</h3>
<table>
<tr><th>チーム</th><th>タンク</th><th>ヒーラー</th><th>DPS（メレー）</th><th>DPS（遠隔）</th><th>フリー</th></tr>
<tr>
<td>アストラ</td>
<td><input type="number" min="0" max="5" value="1" class="tankAst"></td>
<td><input type="number" min="0" max="5" value="1" class="healerAst"></td>
<td><input type="number" min="0" max="5" value="2" class="meleeAst"></td>
<td><input type="number" min="0" max="5" value="1" class="rangedAst"></td>
<td><input type="number" min="0" max="5" value="0" class="freeAst"></td>
</tr>
<tr>
<td>アンブラ</td>
<td><input type="number" min="0" max="5" value="1" class="tankAmb"></td>
<td><input type="number" min="0" max="5" value="1" class="healerAmb"></td>
<td><input type="number" min="0" max="5" value="2" class="meleeAmb"></td>
<td><input type="number" min="0" max="5" value="1" class="rangedAmb"></td>
<td><input type="number" min="0" max="5" value="0" class="freeAmb"></td>
</tr>
</table>
</form>

<h3>メンバー入力 </h3>
<table id="tableIdeal">
<tr><th>名前</th><th>階級・レート</th><th>ロール</th></tr>
</table>
<button id="runIdeal">チーム分け実行</button>
<button id="copyIdeal">結果をコピー（名前のみ）</button>

<h3 class="team-title">アストラ </h3>
<ul id="teamAIdeal"></ul>

<h3 class="team-title">アンブラ </h3>
<ul id="teamBIdeal"></ul>
</section>

<script>
const rankMap={"~ゴールド":1,"プラチナ":2,"ダイアモンド":3,"クリスタル（～1000）":4,"クリスタル（1000～1999）":5,"オメガ":6,"アルテマ":7};
const rankNames=Object.keys(rankMap);
const rankColor={"~ゴールド":"#FFD700","プラチナ":"#00FFFF","ダイアモンド":"#FFA500","クリスタル（～1000）":"#1E90FF","クリスタル（1000～1999）":"#1E90FF","オメガ":"#800080","アルテマ":"#FF0000"};
const roleColor={"タンク":"#1E90FF","ヒーラー":"#32CD32","DPS（メレー）":"#FF4500","DPS（遠隔）":"#FF4500","フリー":"#808080"};
const roles=["タンク","ヒーラー","DPS（メレー）","DPS（遠隔）","フリー"];

// 固定10人入力
const tablePower=document.getElementById("tablePower");
const tableIdeal=document.getElementById("tableIdeal");
for(let i=0;i<10;i++){
  let trP=document.createElement("tr");
  trP.innerHTML=`<td><input class="name"></td>
  <td><select class="power">${rankNames.map(r=>`<option value="${r}">${r}</option>`)}</select></td>`;
  tablePower.appendChild(trP);

  let trI=document.createElement("tr");
  trI.innerHTML=`<td><input class="name"></td>
  <td><select class="power">${rankNames.map(r=>`<option value="${r}">${r}</option>`)}</select></td>
  <td><select class="role">${roles.map(r=>`<option value="${r}">${r}</option>`)}</select></td>`;
  tableIdeal.appendChild(trI);
}

// ---------------------
// 階級・レート参照チーム分け
// ---------------------
let lastTeamsPower=[];
document.getElementById("runPower").onclick = ()=>{
  const rows=[...tablePower.querySelectorAll("tr")].slice(1);
  const players=rows.map(r=>{return {name:r.querySelector(".name").value,power:rankMap[r.querySelector(".power").value],rankName:r.querySelector(".power").value};});
  players.sort((a,b)=>b.power-a.power);
  let teamA=[], teamB=[], sumA=0, sumB=0;
  players.forEach(p=>{if(sumA<=sumB){teamA.push(p);sumA+=p.power;}else{teamB.push(p);sumB+=p.power;}});
  lastTeamsPower=[teamA,teamB];
  ["teamAPower","teamBPower"].forEach((id,i)=>{
    const ul=document.getElementById(id); ul.innerHTML="";
    (i===0?teamA:teamB).forEach(p=>ul.innerHTML+=`<li style="color:white;background-color:${rankColor[p.rankName]}">${p.name}（${p.rankName}）</li>`);
  });
};
document.getElementById("copyPower").onclick = ()=>{
  if(!lastTeamsPower.length){alert("チーム分け実行してください"); return;}
  let text="【アストラ 】\n"; lastTeamsPower[0].forEach(p=>text+=p.name+"\n");
  text+="\n【アンブラ 】\n"; lastTeamsPower[1].forEach(p=>text+=p.name+"\n");
  navigator.clipboard.writeText(text).then(()=>alert("名前だけコピーしました！"));
};

// ---------------------
// ロール編成チーム分け
// ---------------------
let lastTeamsIdeal=[];
document.getElementById("runIdeal").onclick = ()=>{
  const rows=[...tableIdeal.querySelectorAll("tr")].slice(1);
  const players=rows.map(r=>{return {name:r.querySelector(".name").value,power:rankMap[r.querySelector(".power").value],rankName:r.querySelector(".power").value,role:r.querySelector(".role").value};});
  const idealCounts={
    Ast:{ "タンク":parseInt(document.querySelector(".tankAst").value),"ヒーラー":parseInt(document.querySelector(".healerAst").value),"DPS（メレー）":parseInt(document.querySelector(".meleeAst").value),"DPS（遠隔）":parseInt(document.querySelector(".rangedAst").value)},
    Amb:{ "タンク":parseInt(document.querySelector(".tankAmb").value),"ヒーラー":parseInt(document.querySelector(".healerAmb").value),"DPS（メレー）":parseInt(document.querySelector(".meleeAmb").value),"DPS（遠隔）":parseInt(document.querySelector(".rangedAmb").value)}
  };

  lastTeamsIdeal=divideTeamsWithFree(players,idealCounts);

  [["teamAIdeal",lastTeamsIdeal[0]],["teamBIdeal",lastTeamsIdeal[1]]].forEach(([id,team])=>{
    const ul=document.getElementById(id); ul.innerHTML="";
    team.forEach(p=>ul.innerHTML+=`<li style="color:white;background-color:${roleColor[p.role]}">${p.name}：${p.role}（${p.rankName}）</li>`);
  });
};

function divideTeamsWithFree(players,idealCounts){
  const teamA=[],teamB=[];
  ["タンク","ヒーラー","DPS（メレー）","DPS（遠隔）"].forEach(role=>{
    let filtered=players.filter(p=>p.role===role);
    teamA.push(...filtered.splice(0,idealCounts.Ast[role]));
    teamB.push(...filtered.splice(0,idealCounts.Amb[role]));
  });

  // フリー補填で必ず5人に
  let freePlayers=players.filter(p=>!teamA.includes(p)&&!teamB.includes(p));
  while(teamA.length<5 && freePlayers.length>0){let p=freePlayers.shift();p.role="フリー"; teamA.push(p);}
  while(teamB.length<5 && freePlayers.length>0){let p=freePlayers.shift();p.role="フリー"; teamB.push(p);}
  
  return [teamA,teamB];
}

document.getElementById("copyIdeal").onclick = ()=>{
  if(!lastTeamsIdeal.length){alert("チーム分け実行してください"); return;}
  let text="【アストラ】\n"; lastTeamsIdeal[0].forEach(p=>text+=p.name+"\n");
  text+="\n【アンブラ】\n"; lastTeamsIdeal[1].forEach(p=>text+=p.name+"\n");
  navigator.clipboard.writeText(text).then(()=>alert("名前だけコピーしました！"));
};
</script>
</body>
</html>
