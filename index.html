<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>クリコンカスタムチーム分け</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
 font-family:"Noto Serif JP","Yu Mincho",serif;
 max-width:1000px;margin:auto;padding-bottom:260px;
 background:linear-gradient(135deg,#a0e9ff,#f3f0ff,#c0eaff);
 background-size:400% 400%;animation:crystal 15s ease infinite;
}
@keyframes crystal{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.ff-panel{background:rgba(20,20,30,.75);border:1px solid rgba(255,215,120,.6);
 border-radius:12px;padding:15px;margin-bottom:25px;}
h1,h2,h3{text-align:center;color:#f5e6b0}
table{width:100%;border-collapse:collapse;background:rgba(0,0,0,.4);border-radius:10px;margin-bottom:10px;}
th{background:rgba(255,215,120,.15);color:#f5e6b0}
td{padding:6px;text-align:center}
input,select,textarea{width:100%;padding:6px;font-size:16px;border-radius:6px;}
button{padding:6px 10px;font-size:14px;background:linear-gradient(#3a3a4f,#1c1c2a);
 border:1px solid rgba(255,215,120,.7);color:#f5e6b0;border-radius:8px;cursor:pointer;}
ul{list-style:none;padding:0;margin:0}
li{margin:6px 0;color:white}
.master-item{display:flex;justify-content:space-between;align-items:center;
 background:rgba(255,255,255,.08);padding:8px 10px;border-radius:10px;}
.rank-badge{padding:2px 8px;border-radius:999px;font-size:12px;font-weight:bold;color:white}
@keyframes blink{50%{opacity:.3}}
.blink{animation:blink 1s infinite}
.fixed-footer{
 position:fixed;bottom:0;left:0;width:100%;
 background:rgba(20,20,30,.85);
 border-top:1px solid rgba(255,215,120,.5);
 color:#f5e6b0;font-size:12px;text-align:center;padding:10px 0;
}
textarea{resize:none;}
</style>
</head>

<body>

<h1>クリコンカスタムチーム分け</h1>

<!-- 登録済み選手 -->
<div class="ff-panel">
<h2>登録済み選手</h2>
<table>
<tr><th>名前</th><th>階級・レート</th><th></th></tr>
<tr>
<td><input id="pmName"></td>
<td><select id="pmRank"></select></td>
<td><button onclick="addMaster()">追加</button></td>
</tr>
</table>

<input placeholder="名前検索" oninput="filterMaster(this.value)">
<select onchange="sortMaster(this.value)">
<option value="">並び替え</option>
<option value="rank">階級・レート順</option>
<option value="name">名前順</option>
</select>

<ul id="masterList"></ul>
</div>

<!-- チーム分け -->
<div class="ff-panel">
<h2>チーム分け</h2>
<table id="powerTable">
<tr><th>PLAYER</th><th>階級・レート</th></tr>
</table>

<button onclick="run()">チーム分け</button>
<button onclick="reshuffle()">再シャッフル</button>
<button onclick="autoShuffle()">⚡ 最小差まで自動</button>
<button onclick="copyTeams(false)">コピー</button>
<button onclick="copyTeams(true)">/a付き</button>

<h3>アストラ</h3>
<p id="sumA"></p>
<ul id="teamA"></ul>

<h3>アンブラ</h3>
<p id="sumB"></p>
<ul id="teamB"></ul>

<p id="diff"></p>
<p id="good" style="display:none;color:#4CAF50">良バランス</p>
</div>

<!-- 履歴 -->
<div class="ff-panel">
<h2>チーム履歴</h2>
<ul id="history"></ul>
<button onclick="clearHistory()" style="background:#a94442">履歴全削除</button>
</div>

<footer class="fixed-footer">
<p>&copy; 2010 - 2025 SQUARE ENIX CO., LTD. All Rights Reserved.</p>
<p>※本サイトは FINAL FANTASY XIV の非公式ファンツールです。</p>
</footer>

<script>
/* ===== ランク ===== */
const ranks=["～ゴールド","プラチナ","ダイアモンド","クリスタル（～1000）","クリスタル上位（1001～2000）","オメガ（2001～3000）","オメガ上位（3001～4000）","アルテマ（4000～）"];
const rankValue={"～ゴールド":1,"プラチナ":2,"ダイアモンド":3,"クリスタル（～1000）":4,"クリスタル上位（1001～2000）":5,"オメガ（2001～3000）":6,"オメガ上位（3001～4000）":7,"アルテマ（4000～）":8};
const rankColor={"～ゴールド":"#FFD700","プラチナ":"#7FDBFF","ダイアモンド":"#FFA500","クリスタル（～1000）":"#1E90FF","クリスタル上位（1001～2000）":"#0B1C3D","オメガ（2001～3000）":"#800080","オメガ上位（3001～4000）":"#4B0082","アルテマ（4000～）":"#FF0000"};

pmRank.innerHTML=ranks.map(r=>`<option>${r}</option>`).join("");

/* ===== 名簿 ===== */
let master=JSON.parse(localStorage.getItem("masterPlayers")||"[]");
const masterList=document.getElementById("masterList");

function saveMaster(){localStorage.setItem("masterPlayers",JSON.stringify(master))}
function addMaster(){
 const n=pmName.value.trim(); if(!n)return;
 if(master.some(p=>p.name===n))return alert("同名あり");
 master.push({name:n,rank:pmRank.value});
 saveMaster(); pmName.value=""; renderMaster();
}
function deleteMaster(i){master.splice(i,1);saveMaster();renderMaster();}
function renderMaster(){
 masterList.innerHTML="";
 master.forEach((p,i)=>{
  masterList.innerHTML+=`
   <li class="master-item">
    <span>${p.name} <span class="rank-badge" style="background:${rankColor[p.rank]}">${p.rank}</span></span>
    <span>
     <button onclick="useMaster(${i})">使う</button>
     <button onclick="deleteMaster(${i})" style="background:#a94442">削除</button>
    </span>
   </li>`;
 });
}
function sortMaster(t){
 if(t==="rank")master.sort((a,b)=>rankValue[b.rank]-rankValue[a.rank]);
 if(t==="name")master.sort((a,b)=>a.name.localeCompare(b.name,"ja"));
 renderMaster();
}
function filterMaster(w){
 w=w.toLowerCase();
 [...masterList.children].forEach(li=>{
  li.style.display=li.textContent.toLowerCase().includes(w)?"":"none";
 });
}
renderMaster();

/* ===== チーム表 ===== */
const table=document.getElementById("powerTable");
for(let i=0;i<10;i++){
 table.innerHTML+=`<tr><td><input></td><td><select>${ranks.map(r=>`<option>${r}</option>`).join("")}</select></td></tr>`;
}
function useMaster(i){
 const r=[...table.rows].slice(1).find(x=>!x.cells[0].firstChild.value.trim());
 if(!r)return alert("空きなし");
 r.cells[0].firstChild.value=master[i].name;
 r.cells[1].firstChild.value=master[i].rank;
}

/* ===== 共通取得 ===== */
function getPlayers(){
 return [...table.rows].slice(1)
  .map(r=>({
   name:r.cells[0].firstChild.value.trim(),
   rank:r.cells[1].firstChild.value,
   val:rankValue[r.cells[1].firstChild.value]
  }))
  .filter(p=>p.name);
}

/* ===== 表示 ===== */
const teamA=document.getElementById("teamA");
const teamB=document.getElementById("teamB");
const sumA=document.getElementById("sumA");
const sumB=document.getElementById("sumB");
const diff=document.getElementById("diff");
const good=document.getElementById("good");

function show(A,B){
 teamA.innerHTML=""; teamB.innerHTML="";
 let sa=0,sb=0;
 A.forEach(p=>{sa+=p.val;teamA.innerHTML+=`<li style="background:${rankColor[p.rank]}">${p.name}</li>`});
 B.forEach(p=>{sb+=p.val;teamB.innerHTML+=`<li style="background:${rankColor[p.rank]}">${p.name}</li>`});
 sumA.textContent=`合計：${sa}`;
 sumB.textContent=`合計：${sb}`;
 const d=Math.abs(sa-sb);
 diff.textContent=`差：${d}`;
 good.style.display=d<=1?"block":"none";
}

/* ===== チーム分け ===== */
function run(){
 let p=getPlayers().sort((a,b)=>b.val-a.val);
 let A=[],B=[],sa=0,sb=0;
 p.forEach(x=>sa<=sb?(A.push(x),sa+=x.val):(B.push(x),sb+=x.val));
 show(A,B); saveHistory(A,B,"通常");
}
function reshuffle(){
 let p=getPlayers();
 for(let i=p.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]];}
 let A=[],B=[],sa=0,sb=0;
 p.forEach(x=>sa<=sb?(A.push(x),sa+=x.val):(B.push(x),sb+=x.val));
 show(A,B);
}
function autoShuffle(){
 const players=getPlayers();
 let bestDiff=Infinity,bA=[],bB=[];
 for(let t=0;t<1000;t++){
  const s=[...players];
  for(let i=s.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[s[i],s[j]]=[s[j],s[i]];}
  let A=[],B=[],sa=0,sb=0;
  s.forEach(x=>sa<=sb?(A.push(x),sa+=x.val):(B.push(x),sb+=x.val));
  const d=Math.abs(sa-sb);
  if(d<bestDiff){bestDiff=d;bA=A;bB=B;if(d<=1)break;}
 }
 show(bA,bB);
 saveHistory(bA,bB,"自動最適");
}

/* ===== 履歴 ===== */
let history=JSON.parse(localStorage.getItem("history")||"[]");
const historyList=document.getElementById("history");

function saveHistory(A,B,label){
 history.unshift({
  time:new Date().toLocaleString()+"（"+label+"）",
  A:A.map(p=>p.name),
  B:B.map(p=>p.name),
  memo:""
 });
 localStorage.setItem("history",JSON.stringify(history));
 renderHistory();
}
function renderHistory(){
 historyList.innerHTML="";
 history.forEach((h,i)=>{
  historyList.innerHTML+=`
   <li>
    <b>${h.time}</b><br>
    A: ${h.A.join("、")}<br>
    B: ${h.B.join("、")}
    <textarea oninput="history[${i}].memo=this.value;localStorage.setItem('history',JSON.stringify(history))">${h.memo||""}</textarea>
    <button onclick="history.splice(${i},1);localStorage.setItem('history',JSON.stringify(history));renderHistory()" style="background:#a94442">削除</button>
   </li>`;
 });
}
function clearHistory(){history=[];localStorage.setItem("history","[]");renderHistory();}
renderHistory();

/* ===== コピー ===== */
function copyTeams(a){
 let t=a?"/a\n":"";
 [["【アストラ】",teamA],["【アンブラ】",teamB]].forEach(p=>{
  t+=p[0]+"\n";
  [...p[1].children].forEach(li=>t+=li.textContent+"\n");
 });
 navigator.clipboard.writeText(t.trim());
}
</script>

</body>
</html>
